{% extends 'base.html' %}
{% block title %}{% if is_new %}Nowy quiz{% else %}Edytuj quiz{% endif %}{% endblock %}

{% block content %}
  {% if not is_new and quiz %}
    <a href="{% url 'quiz-edit' pk=quiz.pk %}">&larr; Wróć do edytora quizu</a>
  {% else %}
    <a href="{% url 'my-quizzes' %}">&larr; Wróć do moich quizów</a>
  {% endif %}

  <h1>
    {% if is_new %}Utwórz nowy quiz
    {% else %}Edytuj quiz „{{ quiz.title }}”
    {% endif %}
  </h1>

  <form method="post" novalidate>
    {% csrf_token %}

    {% if quiz_form.non_field_errors %}
      <div class="alert alert-danger">{{ quiz_form.non_field_errors }}</div>
    {% endif %}

    <div class="mb-3">
      <label for="{{ quiz_form.title.id_for_label }}" class="form-label">Tytuł</label>
      {{ quiz_form.title }}
      {% for e in quiz_form.title.errors %}<div class="text-danger">{{ e }}</div>{% endfor %}
    </div>

    <div class="mb-3">
      <label for="{{ quiz_form.visibility.id_for_label }}" class="form-label">Widoczność</label>
      {{ quiz_form.visibility }}
      {% for e in quiz_form.visibility.errors %}<div class="text-danger">{{ e }}</div>{% endfor %}
    </div>

    <button type="submit" class="btn btn-primary">
      {% if is_new %}Utwórz{% else %}Zapisz{% endif %}
    </button>

    {% if not is_new and quiz %}
      <a class="btn btn-secondary" href="{% url 'question-create' quiz_pk=quiz.pk %}">Dodaj pytanie</a>
      <a class="btn btn-danger" href="{% url 'quiz-delete' pk=quiz.pk %}">Usuń quiz</a>
    {% endif %}
  </form>

  {% if not is_new and quiz %}
    <h3 style="margin-top:2rem;">Pytania</h3>
    {% if quiz.questions.exists %}
      <ol>
        {% for q in quiz.questions.all %}
          <li>
            {{ q.text }}
            · <a href="{% url 'question-edit' pk=q.pk %}">Edytuj</a>
            · <a href="{% url 'question-delete' pk=q.pk %}">Usuń</a>
          </li>
        {% endfor %}
      </ol>
    {% else %}
      <p>Brak pytań.</p>
    {% endif %}
  {% endif %}
{% endblock %}
